# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö" –∑–∞–¥–∞–Ω–∏–π

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `user_tasks` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `migrations/035_add_frozen_fields_to_user_tasks.sql`

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è:
- `frozen_title` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
- `frozen_description` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è  
- `frozen_task_hint` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ (–∏–∑ `task_places.task_hint`)
- `frozen_category` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `create_task_from_place()`

**–§–∞–π–ª:** `tasks_service.py`, —Å—Ç—Ä–æ–∫–∞ 314-340

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è –∏–∑ –º–µ—Å—Ç–∞ —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `task_hint` –∏–∑ –º–µ—Å—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
- –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç—Å—è –±–∞–∑–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –¥–ª—è –º–µ—Å—Ç–∞

**–ö–æ–¥:**
```python
# –ï—Å–ª–∏ —É –º–µ—Å—Ç–∞ –µ—Å—Ç—å task_hint, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
if place.task_hint:
    frozen_description = f"{task.description}\n\nüí° {place.task_hint}"
    frozen_task_hint = place.task_hint

user_task = UserTask(
    ...
    frozen_title=frozen_title,
    frozen_description=frozen_description,
    frozen_task_hint=frozen_task_hint,
    frozen_category=place.category,
)
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_user_active_tasks()`

**–§–∞–π–ª:** `tasks_service.py`, —Å—Ç—Ä–æ–∫–∞ 437-448

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏–π —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–æ–≤
- –ï—Å–ª–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç (—Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ —à–∞–±–ª–æ–Ω

**–ö–æ–¥:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
if user_task.frozen_title and user_task.frozen_description:
    task_title = user_task.frozen_title
    task_description = user_task.frozen_description
    task_category = user_task.frozen_category or task.category
    task_hint = user_task.frozen_task_hint
else:
    # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞ (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π)
    task_title = task.title
    task_description = task.description
    task_category = task.category
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `UserTask`

**–§–∞–π–ª:** `database.py`, —Å—Ç—Ä–æ–∫–∞ 90-95

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å:
```python
frozen_title: Mapped[str | None] = mapped_column(String(255), nullable=True)
frozen_description: Mapped[str | None] = mapped_column(Text, nullable=True)
frozen_task_hint: Mapped[str | None] = mapped_column(String(200), nullable=True)
frozen_category: Mapped[str | None] = mapped_column(String(20), nullable=True)
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –ü–æ—Ç–æ–∫ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ—Ä–µ—Ç –∫–≤–µ—Å—Ç –∏–∑ "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞"

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –º–µ—Å—Ç–æ —Å task_hint: "–ü–æ–ø—Ä–æ–±—É–π –∫–æ—Ñ–µ, –ø–æ–≥–æ–≤–æ—Ä–∏ —Å –±–∞—Ä–∏—Å—Ç–∞"
2. –ù–∞–∂–∏–º–∞–µ—Ç "üéØ –ó–∞–±—Ä–∞—Ç—å –∫–≤–µ—Å—Ç"
3. create_task_from_place() —Å–æ–∑–¥–∞–µ—Ç UserTask —Å:
   - frozen_title = "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∫–æ—Ñ–µ –≤ –Ω–æ–≤–æ–π –∫–æ—Ñ–µ–π–Ω–µ" (–∏–∑ —à–∞–±–ª–æ–Ω–∞)
   - frozen_description = "–ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–æ—Ñ–µ–π–Ω—é...\n\nüí° –ü–æ–ø—Ä–æ–±—É–π –∫–æ—Ñ–µ, –ø–æ–≥–æ–≤–æ—Ä–∏ —Å –±–∞—Ä–∏—Å—Ç–∞"
   - frozen_task_hint = "–ü–æ–ø—Ä–æ–±—É–π –∫–æ—Ñ–µ, –ø–æ–≥–æ–≤–æ—Ä–∏ —Å –±–∞—Ä–∏—Å—Ç–∞"
   - frozen_category = "food"
4. –ü—Ä–∏ –ª—é–±–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ ("–ú–æ–∏ –∫–≤–µ—Å—Ç—ã", "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ") –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —ç—Ç–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### –ü–æ—Ç–æ–∫ 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏–π

```
1. get_user_active_tasks() –ø–æ–ª—É—á–∞–µ—Ç UserTask
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å—Ç—å –ª–∏ frozen_title –∏ frozen_description?
   - –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   - –ù–ï–¢ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∞–±–ª–æ–Ω (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π)
3. –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –æ–ø–∏—Å–∞–Ω–∏–µ
```

## –ß—Ç–æ –µ—â–µ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
\i migrations/035_add_frozen_fields_to_user_tasks.sql
```

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:
```python
# –î–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π —Å place_id, –Ω–æ –±–µ–∑ frozen_description
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å frozen –¥–∞–Ω–Ω—ã–µ –∏–∑ task_places.task_hint
```

### 3. –£–ª—É—á—à–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é GPT-–æ–ø–∏—Å–∞–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `task_hint` –∏–∑ –º–µ—Å—Ç–∞. –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å:
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GPT –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –µ–≥–æ –≤ `frozen_description`
- –≠—Ç–æ –±—É–¥–µ—Ç –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å** - –∑–∞–¥–∞–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ –∂–µ –æ–ø–∏—Å–∞–Ω–∏–µ
‚úÖ **–†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π** - –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ fallback
‚úÖ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ GPT** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π GPT-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞)

1. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - **–°–î–ï–õ–ê–ù–û**
2. ‚è≥ –£–±—Ä–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –º–µ—Å—Ç–∞ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π)
3. ‚è≥ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å regenerate - –µ—Å–ª–∏ –µ—Å—Ç—å frozen –¥–∞–Ω–Ω—ã–µ, –Ω–µ –∏—Å–∫–∞—Ç—å –º–µ—Å—Ç–æ –∑–∞–Ω–æ–≤–æ
4. ‚è≥ –£–±—Ä–∞—Ç—å `tasks.description` –∏–∑ UI - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ frozen –¥–∞–Ω–Ω—ã–µ
5. ‚è≥ `tasks` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞–≥—Ä–∞–¥/XP/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏

