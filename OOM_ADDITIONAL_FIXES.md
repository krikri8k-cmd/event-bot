# üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç OOM –æ—à–∏–±–∫–∏.

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫

### 1. –ö—ç—à –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (`geocode.py`)
**–ü—Ä–æ–±–ª–µ–º–∞:** `_cache = {}` –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ - –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `_MAX_CACHE_SIZE = 1000` (–º–∞–∫—Å–∏–º—É–º 1000 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ 50% —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

### 2. –ö—ç—à –∞–¥–º–∏–Ω–æ–≤ –≥—Ä—É–ø–ø (`utils/community_events_service.py`)
**–ü—Ä–æ–±–ª–µ–º–∞:** `_admin_cache = {}` –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `_max_cache_size = 200` (–º–∞–∫—Å–∏–º—É–º 200 –≥—Ä—É–ø–ø)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ 50% —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏

### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ reverse geocoding
**–ü—Ä–æ–±–ª–µ–º–∞:** `asyncio.gather(*[enrich_single_event(event) for event in events])` - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏ –¥–ª—è –í–°–ï–• —Å–æ–±—ã—Ç–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 10 —Å–æ–±—ã—Ç–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- ‚úÖ –ë–∞—Ç—á–∏–Ω–≥: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —á–∞—Å—Ç—è–º –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö —Å—Ä–∞–∑—É

### 4. –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –±–µ–∑ limit
**–ü—Ä–æ–±–ª–µ–º–∞:** `session.query(Event.source).distinct().all()` - –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `.limit(50)` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –ö—ç—à/–ò—Å—Ç–æ—á–Ω–∏–∫ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ | –û—á–∏—Å—Ç–∫–∞ |
|--------------|-------------|---------|
| –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ | 1000 –∑–∞–ø–∏—Å–µ–π | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ |
| –ê–¥–º–∏–Ω—ã –≥—Ä—É–ø–ø | 200 –≥—Ä—É–ø–ø | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ |
| Reverse geocoding | 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á | –ë–∞—Ç—á–∏–Ω–≥ |
| –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î | limit(50) | - |

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ö—ç—à–∏ –Ω–µ –º–æ–≥—É—Ç —Ä–∞—Å—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏** - –Ω–∞–π–¥–∏—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–æ—Å—Ç–∞ –ø–∞–º—è—Ç–∏
2. **SQLAlchemy —Å–µ—Å—Å–∏–∏** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
3. **Async –∑–∞–¥–∞—á–∏** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–Ω–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è
4. **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - –Ω–∞–π–¥–∏—Ç–µ –¥—Ä—É–≥–∏–µ –∫—ç—à–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
5. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

## üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –º–µ—Ä—ã

–ï—Å–ª–∏ OOM –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è:
1. –°–Ω–∏–∑—å—Ç–µ `MEMORY_THRESHOLD_MB` –¥–æ 128 –ú–ë
2. –£–º–µ–Ω—å—à–∏—Ç–µ `USER_STATE_MAX_SIZE` –¥–æ 50
3. –£–º–µ–Ω—å—à–∏—Ç–µ `MAX_PREPARED_EVENTS` –¥–æ 10
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–Ω–æ—Å –≤—Å–µ—Ö –∫—ç—à–µ–π –≤ Redis







