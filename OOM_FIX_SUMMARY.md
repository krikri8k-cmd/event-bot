# üîß –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç OOM - –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫–∏ OOM (Out of Memory).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ—Ä–æ–≥–æ–≤

### 1. –ü–æ—Ä–æ–≥ –ø–∞–º—è—Ç–∏ (Memory Guard)
- **–ë—ã–ª–æ:** 512 –ú–ë
- **–°—Ç–∞–ª–æ:** 256 –ú–ë
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞ —Ä–∞–Ω—å—à–µ

### 2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä user_state
- **–ë—ã–ª–æ:** 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–°—Ç–∞–ª–æ:** 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–≠—Ñ—Ñ–µ–∫—Ç:** –í 2.5 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø–∞–º—è—Ç–∏

### 3. TTL –¥–ª—è user_state
- **–ë—ã–ª–æ:** 30 –º–∏–Ω—É—Ç (1800 —Å–µ–∫)
- **–°—Ç–∞–ª–æ:** 15 –º–∏–Ω—É—Ç (900 —Å–µ–∫)
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 4. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ prepared —Å–æ–±—ã—Ç–∏–π
- **–ë—ã–ª–æ:** 50 —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°—Ç–∞–ª–æ:** 20 —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–≠—Ñ—Ñ–µ–∫—Ç:** –í 2.5 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ —Å–æ–±—ã—Ç–∏–π –≤ –ø–∞–º—è—Ç–∏

### 5. –ü—Ä–∏ Memory Guard –æ—á–∏—Å—Ç–∫–∞ prepared_events
- **–ë—ã–ª–æ:** –û—Å—Ç–∞–≤–ª—è–µ–º 25 —Å–æ–±—ã—Ç–∏–π
- **–°—Ç–∞–ª–æ:** –û—Å—Ç–∞–≤–ª—è–µ–º 10 —Å–æ–±—ã—Ç–∏–π
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ï—â—ë –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞

### 6. –ü—Ä–æ—Ü–µ–Ω—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ Memory Guard
- **–ë—ã–ª–æ:** –£–¥–∞–ª—è–µ–º 50% —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
- **–°—Ç–∞–ª–æ:** –£–¥–∞–ª—è–µ–º 70% —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª–µ–µ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞

### 7. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- **–ë—ã–ª–æ:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- **–°—Ç–∞–ª–æ:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- **–≠—Ñ—Ñ–µ–∫—Ç:** –í 3 —Ä–∞–∑–∞ —á–∞—â–µ

### 8. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **–ë—ã–ª–æ:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- **–°—Ç–∞–ª–æ:** –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ë–æ–ª–µ–µ —á–∞—Å—Ç—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
- **–ë—ã–ª–æ:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- **–°—Ç–∞–ª–æ:** –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **–≠—Ñ—Ñ–µ–∫—Ç:** –í 2 —Ä–∞–∑–∞ —á–∞—â–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ—á–∏—â–∞–µ–º

### 10. _processed_callbacks
- **–ë—ã–ª–æ:** –ú–∞–∫—Å–∏–º—É–º 10000, —É–¥–∞–ª—è–µ–º 5000
- **–°—Ç–∞–ª–æ:** –ú–∞–∫—Å–∏–º—É–º 5000, —É–¥–∞–ª—è–µ–º 2500
- **–≠—Ñ—Ñ–µ–∫—Ç:** –í 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ callback ID –≤ –ø–∞–º—è—Ç–∏

### 11. –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –∫–∞—Ä—Ç
- **–î–æ–±–∞–≤–ª–µ–Ω–æ:** `del map_bytes` –∏ `del map_file` –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ä—Ç

### 12. –ë–∞–∑–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–¥–∞
- **–î–æ–±–∞–≤–ª–µ–Ω–æ:** –î–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Ä–æ–≥ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω, –≤—ã–ø–æ–ª–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –æ—á–∏—Å—Ç–∫—É
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|----------|------|-------|-----------|
| MEMORY_THRESHOLD_MB | 512 | 256 | -50% |
| USER_STATE_MAX_SIZE | 500 | 200 | -60% |
| USER_STATE_TTL_SECONDS | 1800 | 900 | -50% |
| MAX_PREPARED_EVENTS | 50 | 20 | -60% |
| Memory Guard: prepared | 25 | 10 | -60% |
| Memory Guard: —É–¥–∞–ª–µ–Ω–∏–µ | 50% | 70% | +40% |
| –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ | 15 –º–∏–Ω | 5 –º–∏–Ω | -67% |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | 5 –º–∏–Ω | 2 –º–∏–Ω | -60% |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ | 60 —Å–µ–∫ | 30 —Å–µ–∫ | -50% |
| _processed_callbacks max | 10000 | 5000 | -50% |

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ –ü–∞–º—è—Ç—å –æ—á–∏—â–∞–µ—Ç—Å—è –≤ 2-3 —Ä–∞–∑–∞ —á–∞—â–µ
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—Å—è –≤ 2-3 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ —É–¥–∞–ª—è–µ—Ç—Å—è 70% –¥–∞–Ω–Ω—ã—Ö (–≤–º–µ—Å—Ç–æ 50%)
- ‚úÖ –ö–∞—Ä—Ç—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏:
```
üìä MEMORY STATS: user_state=123, prepared_events=456, memory=234.5MB
‚ö†Ô∏è MEMORY GUARD: –ü–∞–º—è—Ç—å –ø—Ä–µ–≤—ã—Å–∏–ª–∞ –ø–æ—Ä–æ–≥ (300.0MB > 256MB), –≤—ã–ø–æ–ª–Ω—è—é –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –æ—á–∏—Å—Ç–∫—É
```

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫
2. –°–Ω–∏–∑—å—Ç–µ MEMORY_THRESHOLD_MB –¥–æ 128 –ú–ë
3. –£–º–µ–Ω—å—à–∏—Ç–µ USER_STATE_MAX_SIZE –¥–æ 100
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–Ω–æ—Å user_state –≤ Redis

