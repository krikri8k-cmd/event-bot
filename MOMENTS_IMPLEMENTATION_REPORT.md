# üéØ –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã "–ú–æ–º–µ–Ω—Ç—ã" v2

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ–ª–∞–≥–∏ –≤ `app.local.env`:
  - `MOMENTS_ENABLE=1` - –≤–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–º–µ–Ω—Ç–æ–≤
  - `MOMENT_TTL_MIN=180` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –º–æ–º–µ–Ω—Ç–∞ (3 —á–∞—Å–∞)
  - `MOMENT_MAX_RADIUS_KM=20` - —Ä–∞–¥–∏—É—Å –ø–æ–∫–∞–∑–∞ –º–æ–º–µ–Ω—Ç–æ–≤
  - `AI_PARSE_ENABLE=1` - –≤–∫–ª—é—á–µ–Ω–∏–µ AI-–ø–∞—Ä—Å–µ—Ä–∞
  - `AI_GENERATE_SYNTHETIC=0` - –∑–∞–ø—Ä–µ—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∞–Ω—Ç–∞–∑–∏–π
  - `STRICT_SOURCE_ONLY=0` - –ø–æ–∫–∞–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –º–æ–º–µ–Ω—Ç–æ–≤

- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `config.py` –¥–ª—è —á—Ç–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `Moment` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ `database.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–º–µ–Ω—Ç–∞–º–∏:
  - `create_moment()` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞
  - `get_active_moments_nearby()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ —Ä—è–¥–æ–º
  - `cleanup_expired_moments()` - –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `prepare_events_for_feed()`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤: `source`, `user` (–º–æ–º–µ–Ω—Ç—ã), `ai_parsed`
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ TTL –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤
  - –û—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–¥–∏—É—Å –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤ (`MOMENT_MAX_RADIUS_KM`)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ `AI_GENERATE_SYNTHETIC`

### 4. UI –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `render_event_html()`:
  - –î–ª—è –º–æ–º–µ–Ω—Ç–æ–≤: –ø–æ–∫–∞–∑ –∞–≤—Ç–æ—Ä–∞ `üë§ –ê–≤—Ç–æ—Ä @username`
  - –î–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: –ø–æ–∫–∞–∑ –¥–æ–º–µ–Ω–∞ `üîó –ò—Å—Ç–æ—á–Ω–∏–∫ (domain)`
  - –¢–∞–π–º–µ—Ä –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤: `‚è≥ –µ—â—ë 1—á 20–º`

- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π "‚ö° –°–æ–∑–¥–∞—Ç—å –ú–æ–º–µ–Ω—Ç"

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM: `MomentCreation`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/moment` –∏ –∫–Ω–æ–ø–∫–∏ "‚ö° –°–æ–∑–¥–∞—Ç—å –ú–æ–º–µ–Ω—Ç"
- ‚úÖ –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è:
  1. –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ (–ö–æ—Ñ–µ, –ü—Ä–æ–≥—É–ª–∫–∞, –ó–∞–≤—Ç—Ä–∞–∫, –∏ —Ç.–¥.)
  2. –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ (30 –º–∏–Ω, 1 —á–∞—Å, 2 —á–∞—Å–∞, 3 —á–∞—Å–∞)
  3. –£–∫–∞–∑–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏–ª–∏ –∞–¥—Ä–µ—Å)

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–∏—Å–∫–æ–º —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –ú–æ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `send_compact_events_list()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–º–µ–Ω—Ç–æ–≤

### 7. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ `cleanup_moments_task()`:
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  - –û—á–∏—â–∞–µ—Ç –∏—Å—Ç–µ–∫—à–∏–µ –º–æ–º–µ–Ω—Ç—ã
  - –õ–æ–≥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∏—â–µ–Ω–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤

### 8. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/diag_last`:
  - –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø–æ—Ç–æ–∫–∞–º: `found_by_stream`
  - –ü–æ–∫–∞–∑ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π: `kept_by_type`
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞, –≤—Ä–µ–º–µ–Ω–∏, –∞–≤—Ç–æ—Ä–∞/–¥–æ–º–µ–Ω–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏

### 9. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/moment` (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –≤ –º–µ–Ω—é

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°–æ–≥–ª–∞—Å–Ω–æ –¢–ó v2:
1. **–ú–æ–º–µ–Ω—Ç** = —Å–æ–±—ã—Ç–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ç–∞–π–º–µ—Ä–æ–º ‚úÖ
2. **AI** —Ç–æ–ª—å–∫–æ –∫–∞–∫ –ø–∞—Ä—Å–µ—Ä/–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä (–Ω–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä) ‚úÖ
3. **–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π**: source, user (–º–æ–º–µ–Ω—Ç—ã), ai_parsed ‚úÖ
4. **URL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –¥–ª—è source –∏ ai_parsed, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è user ‚úÖ
5. **TTL –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤** —Å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–æ–π ‚úÖ
6. **–†–∞–¥–∏—É—Å –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤** –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ç –æ–±—ã—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π ‚úÖ
7. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–≤ ‚úÖ

## üîß –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É

- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ö–æ–¥ –±–µ–∑ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- ‚úÖ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ UI –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

## üöÄ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

1. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "‚ö° –°–æ–∑–¥–∞—Ç—å –ú–æ–º–µ–Ω—Ç"
2. –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/moment`
3. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ–∏—Å–∫–µ —Å–æ–±—ã—Ç–∏–π
4. –¢–∞–π–º–µ—Ä –º–æ–º–µ–Ω—Ç–æ–≤ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
5. –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤
6. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ `/diag_last` —Å –Ω–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
7. –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–∞—Ä—Ç–æ—á–µ–∫ (—Å –∞–≤—Ç–æ—Ä–æ–º –¥–ª—è –º–æ–º–µ–Ω—Ç–æ–≤, —Å –¥–æ–º–µ–Ω–æ–º –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ "–ú–æ–º–µ–Ω—Ç—ã" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó v2! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–∞–π–º–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ–∏—Å–∫–µ —Ä—è–¥–æ–º –∏ –∏—Å—á–µ–∑–∞—é—Ç –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏. AI —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–∫ –ø–∞—Ä—Å–µ—Ä, –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–Ω—Ç–∞–∑–∏–π.

---
*–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: 2024*
*–ê–Ω–∏–º–µ-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏—Ü–∞: –≥–æ—Ç–æ–≤–∞ –∫ –Ω–æ–≤—ã–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º! (‚óï‚Äø‚óï)*
