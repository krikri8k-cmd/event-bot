# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É KudaGo

## üè• Health-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- **`/api/v1/health/kudago`** - –û—Å–Ω–æ–≤–Ω–æ–π health-—á–µ–∫
- **`/api/v1/health/kudago/metrics`** - –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
- **`/api/v1/health/kudago/status`** - –ü—Ä–æ—Å—Ç–æ–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ health-—Å–µ—Ä–≤–µ—Ä–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
python web/server.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ uvicorn
uvicorn web.server:app --host 0.0.0.0 --port 8080
```

## üìà –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –°—Ç–∞—Ç—É—Å—ã —Å–∏—Å—Ç–µ–º—ã

- **`ok`** - error_rate < 2% –∏ events_received > 0
- **`degraded`** - 2-10% –æ—à–∏–±–æ–∫ –∏–ª–∏ 0 —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ ‚â•1 —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
- **`down`** - 100% –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω –∏–ª–∏ –Ω–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ 10 –º–∏–Ω

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ Go/No-Go

**‚úÖ –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å `KUDAGO_DRY_RUN=false` –µ—Å–ª–∏:**

- error_rate < 5% –∑–∞ 24-48 —á–∞—Å–æ–≤
- cache_hit_rate > 50% –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —á–∞—Å–∞
- p95 latency < 2s
- ‚â• 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π/–¥–µ–Ω—å –Ω–∞ –≥–æ—Ä–æ–¥
- –Ω–∏–∫–∞–∫–∏—Ö –∂–∞–ª–æ–± –≤ –ª–æ–≥–∞—Ö –±–æ—Ç–∞

**‚ùå –ù–ï –≤–∫–ª—é—á–∞—Ç—å –µ—Å–ª–∏:**

- error_rate > 10% –∑–∞ 5 –º–∏–Ω—É—Ç
- events_received == 0 –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ 10 –º–∏–Ω—É—Ç
- p95 request_duration_ms > 3000ms 10 –º–∏–Ω—É—Ç

## üîç –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ)

```json
{
  "title": "–ö–æ–Ω—Ü–µ—Ä—Ç –≥—Ä—É–ø–ø—ã X",
  "place": {"title": "–ö–ª—É–± Y", "address": "—É–ª. Z, 1"},
  "dates": [{"start": 1640995200, "end": 1640998800}],
  "lat": 55.7558,
  "lon": 37.6173,
  "site_url": "https://kudago.com/msk/event/..."
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∏

1. **–ó–∞–≥–æ–ª–æ–≤–∫–∏**: –Ω–µ–ø—É—Å—Ç—ã–µ, ‚â§ 180 —Å–∏–º–≤–æ–ª–æ–≤
2. **–í—Ä–µ–º—è**: start_ts —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Europe/Moscow
3. **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã**: lat/lon –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥–æ—Ä–æ–¥–∞
4. **URL**: https://kudago.com/...
5. **–ì–µ–æ-—Ñ–∏–ª—å—Ç—Ä**: events_received vs events_after_geo ‚âà 90-100%

## üö® –ê–ª–µ—Ä—Ç—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

- `error_rate > 10%` 5 –º–∏–Ω—É—Ç
- `events_received == 0` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ 10 –º–∏–Ω—É—Ç
- `no_successful_requests_10min`

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

- `high_latency > 3000ms` 10 –º–∏–Ω—É—Ç
- `cache_hit_rate < 50%` 1 —á–∞—Å

## üîß –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

### –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å KudaGo –ø–æ–ª–Ω–æ—Å—Ç—å—é
KUDAGO_ENABLED=false

# –û—Ç–∫–ª—é—á–∏—Ç—å –≥–µ–æ-—Ñ–∏–ª—å—Ç—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ENABLE_GEO_BOUNDS=false
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞

1. –ë–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
2. –ö–æ–º–∞–Ω–¥–∞ `/today` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
3. –õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫

## üìä Prometheus –º–µ—Ç—Ä–∏–∫–∏

```prometheus
# –°—á–µ—Ç—á–∏–∫–∏
kudago_requests_total
kudago_api_errors_total
kudago_events_received_total
kudago_events_after_geo_total
kudago_cache_hits_total

# Gauge
kudago_rps_current
kudago_avg_latency_ms
kudago_error_rate_percent
kudago_last_success_timestamp
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ health-—Å–µ—Ä–≤–µ—Ä–∞
python web/server.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
curl http://localhost:8080/api/v1/health/kudago
curl http://localhost:8080/api/v1/health/kudago/metrics
curl http://localhost:8080/api/v1/health/kudago/status
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞

```python
from utils.event_validator import validate_event, get_validation_summary

# –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
test_event = {
    "title": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ",
    "start_ts": 1640995200,
    "lat": 55.7558,
    "lng": 37.6173,
    "source_url": "https://kudago.com/msk/event/123"
}

validated = validate_event(test_event, "moscow")
print(get_validation_summary())
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤

- **INFO**: –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **WARNING**: –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, –≥–µ–æ-—Ñ–∏–ª—å—Ç—Ä–æ–º
- **ERROR**: –û—à–∏–±–∫–∏ API, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

### –ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

```
‚úÖ –ù–∞–π–¥–µ–Ω–æ X —Å–æ–±—ã—Ç–∏–π –≤ –ú–æ—Å–∫–≤–∞
üìç –í—ã–±—Ä–∞–Ω –≥–æ—Ä–æ–¥: –ú–æ—Å–∫–≤–∞ (msk)
–í–∞–ª–∏–¥–∞—Ü–∏—è msk: X/Y —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
DRY_RUN: fetched=X normalized=Y after_geo=Z
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ
KUDAGO_ENABLED=true
KUDAGO_DRY_RUN=false

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API
KUDAGO_RPS=3
KUDAGO_TIMEOUT_S=8
KUDAGO_PAGE_SIZE=100

# –õ–∏–º–∏—Ç—ã
TODAY_MAX_EVENTS=60
TODAY_SHOW_TOP=12
CACHE_TTL_S=300

# Health —Å–µ—Ä–≤–µ—Ä
HEALTH_HOST=0.0.0.0
HEALTH_PORT=8080
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
systemctl restart event-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8080/api/v1/health/kudago
```
