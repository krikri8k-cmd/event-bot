# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ GitHub Actions

## üìã –ó–∞–¥–∞—á–∞
–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `sql/2025_ics_sources_and_indexes.sql` –∫ –ø—Ä–æ–¥-–±–∞–∑–µ (Railway) —á–µ—Ä–µ–∑ workflow DB Apply –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –º–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç.

## ‚úÖ –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ workflow –≤ GitHub Actions

### 1. –û—Ç–∫—Ä–æ–π GitHub Actions
- –ü–µ—Ä–µ–π–¥–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
- –ù–∞–∂–º–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Actions**

### 2. –ù–∞–π–¥–∏ workflow "DB Apply"
- –í —Å–ø–∏—Å–∫–µ workflows –Ω–∞–π–¥–∏ **"DB Apply (manual)"**
- –ù–∞–∂–º–∏ –Ω–∞ –Ω–µ–≥–æ

### 3. –ó–∞–ø—É—Å—Ç–∏ workflow
- –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É **"Run workflow"** (—Å–ø—Ä–∞–≤–∞)
- –í –ø–æ–ª–µ **"SQL file path"** –æ—Å—Ç–∞–≤—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
  ```
  sql/2025_ics_sources_and_indexes.sql
  ```
- –ù–∞–∂–º–∏ **"Run workflow"**

### 4. –°–ª–µ–¥–∏ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è workflow
- –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:
  ```
  Connecting with $DATABASE_URL
  Applying 2025_ics_sources_and_indexes.sql
  CREATE TABLE event_sources ...
  CREATE INDEX ...
  Done.
  ```

## üîß –®–∞–≥ 2: –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DB?sslmode=require"

# –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python test_db_connection.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ psql (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
psql "postgresql://USER:PASSWORD@HOST:PORT/DB?sslmode=require" -c "select current_database();"
```

## üêõ –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:

1. **server does not support SSL / SSL is required**
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ URL –µ—Å—Ç—å `?sslmode=require`
   - –î–ª—è Railway –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω–æ `require`

2. **could not translate host name**
   - –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å HOST –≤ DATABASE_URL
   - –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –æ–ø–µ—á–∞—Ç–æ–∫

3. **password authentication failed**
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
   - –í–æ–∑–º–æ–∂–Ω–æ, –ø–∞—Ä–æ–ª—å –∏—Å—Ç—ë–∫ (—Ä–æ—Ç–∞—Ü–∏—è –≤ Railway)

4. **timeout**
   - –†–µ–¥–∫–æ –Ω–∞ Railway
   - –ü—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—Ç/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ï—Å–ª–∏ –±—ã–ª–∏ —É—Ç–µ—á–∫–∏/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å URL:
1. –í Railway –Ω–∞–∂–º–∏ **Rotate/Regenerate connection string**
2. –û–±–Ω–æ–≤–∏ —Å–µ–∫—Ä–µ—Ç `DATABASE_URL` –≤ GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions
3. –ò—Å–ø–æ–ª—å–∑—É–π –Ω–æ–≤—ã–π URL –≤ —Ñ–æ—Ä–º–∞—Ç–µ psql

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

- [ ] Workflow DB Apply –∑–∞–≤–µ—Ä—à–∏–ª—Å—è **Success**
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü/–∏–Ω–¥–µ–∫—Å–æ–≤
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) psql –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è –ë–î –±–µ–∑ –æ—à–∏–±–æ–∫

## üìù –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º

1. **–°—Å—ã–ª–∫—É –Ω–∞ —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ Actions**
2. **–ö–æ—Ä–æ—Ç–∫–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –ª–æ–≥–∞** —Å CREATE TABLE/INDEX –∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º ¬´Done¬ª
3. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤—ã–≤–æ–¥ psql-–ø—Ä–æ–≤–µ—Ä–∫–∏**

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Actions](https://github.com/krikri8k-cmd/event-bot/actions)
- [Railway Dashboard](https://railway.app/dashboard)
- [Workflow —Ñ–∞–π–ª](.github/workflows/db-apply.yml)
- [SQL –º–∏–≥—Ä–∞—Ü–∏—è](sql/2025_ics_sources_and_indexes.sql)

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ IDE ¬´Context access might be invalid: DATABASE_URL¬ª –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å ‚Äî –Ω–∞ —Ä–∞–Ω—Ç–∞–π–º–µ GitHub –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç `${{ secrets.DATABASE_URL }}`.
