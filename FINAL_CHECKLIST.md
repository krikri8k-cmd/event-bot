# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö-–õ–ò–°–¢: –ó–∞–∫—Ä—ã—Ç—å —Ç–µ–º—É –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –Ω–∞–≤—Å–µ–≥–¥–∞

## üéØ –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è –æ—Å–Ω–æ–≤–∞

> **location-first –∏–≥—Ä–∞, –≥–¥–µ –∫–≤–µ—Å—Ç = –æ–ø—ã—Ç –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–µ—Å—Ç–µ**
> 
> –ö–≤–µ—Å—Ç –Ω–µ–ª—å–∑—è ¬´–ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å¬ª, –Ω–µ–ª—å–∑—è ¬´–¥–æ–¥—É–º–∞—Ç—å¬ª, –Ω–µ–ª—å–∑—è ¬´–ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ç—å¬ª.
> –û–Ω –ª–∏–±–æ **–ø—Ä–∏–Ω—è—Ç**, –ª–∏–±–æ **–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**.

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 1.1 –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
```sql
SELECT column_name 
FROM information_schema.columns 
WHERE table_name = 'user_tasks' 
AND column_name LIKE 'frozen%';
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 4 —Å—Ç—Ä–æ–∫–∏ (frozen_title, frozen_description, frozen_task_hint, frozen_category)

### 1.2 –ü–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
**–§–∞–π–ª:** `database.py`, —Å—Ç—Ä–æ–∫–∏ 98-101
```python
frozen_title: Mapped[str | None] = mapped_column(String(255), nullable=True)
frozen_description: Mapped[str | None] = mapped_column(Text, nullable=True)
frozen_task_hint: Mapped[str | None] = mapped_column(String(200), nullable=True)
frozen_category: Mapped[str | None] = mapped_column(String(20), nullable=True)
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π

### 2.1 `create_task_from_place()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç frozen –¥–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü—Ä–∞–≤–∏–ª–æ:** 
- –ï—Å–ª–∏ –µ—Å—Ç—å `place.task_hint` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º **–¢–û–õ–¨–ö–û** –µ–≥–æ (–Ω–µ —Å–º–µ—à–∏–≤–∞–µ–º —Å —à–∞–±–ª–æ–Ω–æ–º)
- –ï—Å–ª–∏ –Ω–µ—Ç `place.task_hint` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —à–∞–±–ª–æ–Ω –∫–∞–∫ fallback

**–§–∞–π–ª:** `tasks_service.py`, —Ñ—É–Ω–∫—Ü–∏—è `create_task_from_place()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
if place.task_hint:
    frozen_title = place.task_hint  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
    frozen_description = place.task_hint  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
else:
    frozen_title = task.title  # ‚úÖ Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –º–µ—Å—Ç
    frozen_description = task.description  # ‚úÖ Fallback
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 3: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π

### 3.1 `get_user_active_tasks()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç frozen –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∞–≤–∏–ª–æ:** `user_tasks` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è UI

**–§–∞–π–ª:** `tasks_service.py`, —Ñ—É–Ω–∫—Ü–∏—è `get_user_active_tasks()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
if has_frozen_fields:
    task_title = user_task.frozen_title  # ‚úÖ –ò–∑ frozen
    task_description = user_task.frozen_description  # ‚úÖ –ò–∑ frozen
else:
    task_title = task.title  # ‚ö†Ô∏è Fallback (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π)
    task_description = task.description  # ‚ö†Ô∏è Fallback
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å fallback (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π fallback —Å—Ç–∞–Ω–µ—Ç —Ä–µ–¥–∫–æ—Å—Ç—å—é)

### 3.2 –í UI –ù–ï–¢ –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `task.title/description`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
grep -r "task\.title\|task\.description\|task\.category" bot_enhanced_v3.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 
- ‚ùå –ù–ï–¢ `task.title` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `task['title']` –∏–∑ —Å–ª–æ–≤–∞—Ä—è, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç frozen –¥–∞–Ω–Ω—ã–µ)
- ‚ùå –ù–ï–¢ `task.description` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `task['description']` –∏–∑ —Å–ª–æ–≤–∞—Ä—è)
- ‚úÖ –ï—Å—Ç—å `task['title']` –∏ `task['description']` - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∏–∑ `get_user_active_tasks()`)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å –∏–∑ `get_user_active_tasks()`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç frozen –¥–∞–Ω–Ω—ã–µ

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 4: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π

### 4.1 –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω

**–§–∞–π–ª:** `scripts/migrate_old_tasks_to_frozen.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ `UserTask` –±–µ–∑ frozen –¥–∞–Ω–Ω—ã—Ö
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç `frozen_*` –ø–æ–ª—è:
  - –ï—Å–ª–∏ –µ—Å—Ç—å `place.task_hint` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ
  - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∞–±–ª–æ–Ω

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω

### 4.2 –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω

```bash
python scripts/migrate_old_tasks_to_frozen.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:
   - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: X
   - –ü—Ä–æ–ø—É—â–µ–Ω–æ: Y
   - –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: Z
```

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 5: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### 5.1 `tasks` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è:
- ‚úÖ XP (–æ–ø—ã—Ç)
- ‚úÖ –ù–∞–≥—Ä–∞–¥
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∞

### 5.2 `tasks` –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- ‚ùå UI (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞)
- ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π
- ‚ùå –°–º–µ—à–∏–≤–∞–Ω–∏—è —Å frozen –¥–∞–Ω–Ω—ã–º–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–±–ª—é–¥–∞–µ—Ç—Å—è

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢ 6: Smoke-test —Å—Ü–µ–Ω–∞—Ä–∏–π

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞"
2. –í—ã–±–∏—Ä–∞–µ—Ç –º–µ—Å—Ç–æ —Å `task_hint`
3. –ù–∞–∂–∏–º–∞–µ—Ç "üéØ –ó–∞–±—Ä–∞—Ç—å –∫–≤–µ—Å—Ç"
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í –ë–î `UserTask` —Å–æ–∑–¥–∞–Ω —Å `frozen_title = place.task_hint`
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í "–ú–æ–∏ –∫–≤–µ—Å—Ç—ã" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `task_hint`, –∞ –Ω–µ —à–∞–±–ª–æ–Ω

### –¢–µ—Å—Ç 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "–ú–æ–∏ –∫–≤–µ—Å—Ç—ã"
2. –í–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–¥–∞–Ω–∏—è
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `frozen_description`, –∞ –Ω–µ `task.description`

### –¢–µ—Å—Ç 3: –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∑–∞–¥–∞–Ω–∏–µ –≤ "–ú–æ–∏ –∫–≤–µ—Å—Ç—ã"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏"
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç, —á—Ç–æ –∏ –≤ "–ú–æ–∏ –∫–≤–µ—Å—Ç—ã"

### –¢–µ—Å—Ç 4: –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ–ª—É—á–∏–ª–∏ frozen –¥–∞–Ω–Ω—ã–µ
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å frozen –¥–∞–Ω–Ω—ã–º–∏

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò

### ‚ùå –ù–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨:
1. `task.title` –≤ UI –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ `task['title']` –∏–∑ —Å–ª–æ–≤–∞—Ä—è)
2. `task.description` –≤ UI –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ `task['description']` –∏–∑ —Å–ª–æ–≤–∞—Ä—è)
3. –°–º–µ—à–∏–≤–∞–Ω–∏—è `task.description` —Å `place.task_hint` –≤ `frozen_description`
4. Fallback –Ω–∞ —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö)

### ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨:
1. `frozen_title` –∏ `frozen_description` –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è
2. `get_user_active_tasks()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç frozen –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª–æ–≤–∞—Ä–µ
3. UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–ª–æ–≤–∞—Ä—è (–∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç frozen)
4. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω

---

## üìã –ü–û–†–Ø–î–û–ö –î–ï–ô–°–¢–í–ò–ô

1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 035
2. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å frozen –ø–æ–ª—è –≤ `database.py`
3. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤ `tasks_service.py` (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
4. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞–Ω–∏–π
5. ‚è≥ –í—ã–ø–æ–ª–Ω–∏—Ç—å smoke-test —Å—Ü–µ–Ω–∞—Ä–∏–π
6. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ –∏—Å—á–µ–∑–ª–∏

---

## üéØ –ö–†–ò–¢–ï–†–ò–ô –£–°–ü–ï–•–ê

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏:**
- ‚úÖ –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è —Å frozen –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –í—Å–µ —Ä–∞–∑–¥–µ–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–µ–∫—Å—Ç
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ "–ø–µ—Ä–µ—Ç–∏—Ä–∞–µ—Ç" —Å–º—ã—Å–ª –∑–∞–¥–∞–Ω–∏—è
- ‚úÖ GPT-–ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞–Ω–∏—è –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

**–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí —Ç–µ–º–∞ –∑–∞–∫—Ä—ã—Ç–∞ –Ω–∞–≤—Å–µ–≥–¥–∞! üéâ**

