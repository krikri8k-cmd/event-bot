# üèóÔ∏è –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∑–∞–¥–∞–Ω–∏–π –∏ –ª–æ–∫–∞—Ü–∏–π

## üìã –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é—Ç **2 —Ä–∞–∑–Ω—ã–µ –ª–æ–≥–∏–∫–∏** —Å –ª–æ–∫–∞—Ü–∏—è–º–∏:
1. **–°—Ç–∞—Ä–∞—è**: `Task.location_url` - –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –≤ –∑–∞–¥–∞–Ω–∏–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º)
2. **–ù–æ–≤–∞—è**: `TaskPlace` - –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –º–µ—Å—Ç–∞–º–∏, –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `tasks_location_service.py`

## üéØ –¶–µ–ª–∏ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è –Ω–∞ —Ç–∏–ø—ã: **–≥–æ—Ä–æ–¥—Å–∫–∏–µ** (`urban`), **–æ—Å—Ç—Ä–æ–≤–Ω—ã–µ** (`island`), **–ø–æ–¥–≤–æ–¥–Ω—ã–µ** (`underwater`) –∏ —Ç.–¥.
2. ‚úÖ –û—Ç–Ω–µ—Å—Ç–∏ —Ä–µ–≥–∏–æ–Ω—ã –∫ —Ç–∏–ø—É: **–æ—Å—Ç—Ä–æ–≤** (`island`) –∏–ª–∏ **–≥–æ—Ä–æ–¥** (`city`)
3. ‚úÖ –ë—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–µ–≥–∏–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –ö –∑–∞–¥–∞–Ω–∏—è–º –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –ª–æ–∫–∞—Ü–∏–∏ –∏–∑ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
5. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `TaskPlace`, —É–±—Ä–∞—Ç—å `location_url` –∏–∑ `Task`

## üóÑÔ∏è –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `task_type` –≤ —Ç–∞–±–ª–∏—Ü—É `tasks`

```sql
ALTER TABLE tasks 
ADD COLUMN task_type VARCHAR(20) DEFAULT 'urban';
-- 'urban' - –≥–æ—Ä–æ–¥—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
-- 'island' - –æ—Å—Ç—Ä–æ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è  
-- 'underwater' - –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
-- –∏ —Ç.–¥.
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `region_type` –≤ —Ä–µ–≥–∏–æ–Ω—ã (—á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É)

**–í–∞—Ä–∏–∞–Ω—Ç –ê**: –†–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `get_user_region()` —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–∏–ø —Ä–µ–≥–∏–æ–Ω–∞

**–í–∞—Ä–∏–∞–Ω—Ç –ë**: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `regions`:
```sql
CREATE TABLE regions (
    code VARCHAR(50) PRIMARY KEY,  -- 'moscow', 'spb', 'bali', 'jakarta'
    name VARCHAR(255) NOT NULL,
    region_type VARCHAR(20) NOT NULL,  -- 'city' –∏–ª–∏ 'island'
    lat_min FLOAT,
    lat_max FLOAT,
    lng_min FLOAT,
    lng_max FLOAT
);

INSERT INTO regions VALUES
('moscow', '–ú–æ—Å–∫–≤–∞', 'city', 55.5, 56.0, 37.3, 37.9),
('spb', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', 'city', 59.8, 60.1, 30.0, 30.6),
('bali', '–ë–∞–ª–∏', 'island', -8.9, -8.1, 114.4, 115.6),
('jakarta', '–î–∂–∞–∫–∞—Ä—Ç–∞', 'city', -6.4, -6.1, 106.6, 106.9);
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `task_type` –≤ —Ç–∞–±–ª–∏—Ü—É `task_places`

```sql
ALTER TABLE task_places 
ADD COLUMN task_type VARCHAR(20) DEFAULT 'urban';
-- –°–≤—è–∑—å: –∫–∞–∫–∏–µ —Ç–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –º–µ—Å—Ç–æ
```

### 4. –£–±—Ä–∞—Ç—å `location_url` –∏–∑ `tasks` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–æ–ª–Ω–æ–π —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏)

```sql
-- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ
-- –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
```

## üîÑ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ä–µ–≥–∏–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
def get_user_region_type(lat: float, lng: float) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ä–µ–≥–∏–æ–Ω–∞: 'city' –∏–ª–∏ 'island'
    """
    region = get_user_region(lat, lng)
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–±–ª–∏—Ü—É regions –∏–ª–∏ —Ö–∞—Ä–¥–∫–æ–¥
    region_types = {
        'moscow': 'city',
        'spb': 'city', 
        'bali': 'island',
        'jakarta': 'city',
    }
    return region_types.get(region, 'city')
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –ø–æ —Ç–∏–ø—É —Ä–µ–≥–∏–æ–Ω–∞

```python
def get_daily_tasks(category: str, region_type: str, date: datetime | None = None) -> list[Task]:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–∏–ø–∞ —Ä–µ–≥–∏–æ–Ω–∞
    
    Args:
        category: 'body' –∏–ª–∏ 'spirit'
        region_type: 'city' –∏–ª–∏ 'island'
        date: –¥–∞—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π
    """
    # –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ task_type, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É region_type
    task_type = 'urban' if region_type == 'city' else 'island'
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

### 3. –ü—Ä–∏–≤—è–∑–∫–∞ –º–µ—Å—Ç –∫ –∑–∞–¥–∞–Ω–∏—è–º

```python
def get_tasks_with_places(
    category: str, 
    task_type: str,  # 'urban' –∏–ª–∏ 'island'
    user_id: int, 
    user_lat: float, 
    user_lng: float
) -> list[dict]:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è —Å –ª–æ–∫–∞—Ü–∏—è–º–∏, —É—á–∏—Ç—ã–≤–∞—è —Ç–∏–ø –∑–∞–¥–∞–Ω–∏—è
    """
    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Å—Ç–∞ –ø–æ task_type
    places = session.query(TaskPlace).filter(
        TaskPlace.category == category,
        TaskPlace.task_type == task_type,  # –ù–û–í–û–ï!
        TaskPlace.is_active == True,
        TaskPlace.region == region,
    )
```

## üìù –ü—Ä–∏–º–µ—Ä—ã

### –ó–∞–¥–∞–Ω–∏—è:
- **–ì–æ—Ä–æ–¥—Å–∫–∏–µ** (`urban`): "–ü—Ä–æ–±–µ–∂–∫–∞ –≤ –ø–∞—Ä–∫–µ", "–ô–æ–≥–∞ –≤ —Å—Ç—É–¥–∏–∏", "–ö–æ—Ñ–µ –≤ –∫–∞—Ñ–µ"
- **–û—Å—Ç—Ä–æ–≤–Ω—ã–µ** (`island`): "–°–µ—Ä—Ñ–∏–Ω–≥ –Ω–∞ –ø–ª—è–∂–µ", "–ô–æ–≥–∞ –Ω–∞ –ø–ª—è–∂–µ", "–°–Ω–æ—Ä–∫–ª–∏–Ω–≥"
- **–ü–æ–¥–≤–æ–¥–Ω—ã–µ** (`underwater`): "–ü–æ–ø–ª–∞–≤–∞–π —Å —Ä—ã–±–∫–∞–º–∏", "–î–∞–π–≤–∏–Ω–≥", "–°–Ω–æ—Ä–∫–ª–∏–Ω–≥ —Å —á–µ—Ä–µ–ø–∞—Ö–∞–º–∏"

### –†–µ–≥–∏–æ–Ω—ã:
- **–ì–æ—Ä–æ–¥–∞** (`city`): –ú–æ—Å–∫–≤–∞, –°–ü–±, –î–∂–∞–∫–∞—Ä—Ç–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `urban` –∑–∞–¥–∞–Ω–∏—è
- **–û—Å—Ç—Ä–æ–≤–∞** (`island`): –ë–∞–ª–∏ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `island` –∑–∞–¥–∞–Ω–∏—è

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π (–ø–æ–¥–≤–æ–¥–Ω—ã–µ, –≥–æ—Ä–Ω—ã–µ –∏ —Ç.–¥.)
2. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è**: –û–¥–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –º–µ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ `TaskPlace`
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–≥–∏–æ–Ω—ã –∏ —Ç–∏–ø—ã
4. **–ß–∏—Å—Ç–æ—Ç–∞**: –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏

## üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π `task_type` –≤ `tasks` –∏ `task_places`
2. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `regions` –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞
3. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ —Ä–µ–≥–∏–æ–Ω–∞
4. –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–∏–≤—è–∑–∫–∏ –º–µ—Å—Ç –∫ –∑–∞–¥–∞–Ω–∏—è–º
5. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π)
6. –£–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Task.location_url` –≤ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–µ

