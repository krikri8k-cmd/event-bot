"""Добавление заданий для food/island"""

import os
import sys
from pathlib import Path

from dotenv import load_dotenv

project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from database import Task, get_session, init_engine  # noqa: E402

env_path = project_root / "app.local.env"
if env_path.exists():
    load_dotenv(env_path)

database_url = os.getenv("DATABASE_URL")
if not database_url:
    print("ERROR: DATABASE_URL not found")
    sys.exit(1)

init_engine(database_url)

# Задания для food/island (скопированы из food/urban)
tasks_data = [
    (
        "Попробовать кофе в новой кофейне",
        "Найдите новую кофейню и попробуйте там кофе. Поговорите с бариста о сортах и способах заваривания.",
        1,
    ),
    (
        "Попробовать местную кухню",
        "Сходите в ресторан местной кухни. Попробуйте традиционные блюда и узнайте их историю.",
        2,
    ),
    (
        "Посетить фуд-маркет",
        "Пройдитесь по фуд-маркету или фермерскому рынку. Попробуйте свежие продукты и пообщайтесь с продавцами.",
        3,
    ),
    ("Попробовать уличную еду", "Попробуйте уличную еду в новом месте. Откройте для себя новые вкусы и рецепты.", 4),
    ("Сходить в пекарню", "Посетите местную пекарню. Попробуйте свежую выпечку и узнайте секреты приготовления.", 5),
    (
        "Попробовать веганское блюдо",
        "Попробуйте веганское блюдо в ресторане или кафе. Откройте для себя новые вкусы и подходы к питанию.",
        6,
    ),
    (
        "Попробовать десерт в кондитерской",
        "Сходите в кондитерскую и попробуйте новый десерт. Сладкое настроение гарантировано!",
        7,
    ),
    (
        "Попробовать блюдо другой культуры",
        "Попробуйте блюдо из кухни другой культуры. Расширьте свой гастрономический кругозор.",
        8,
    ),
    (
        "Попробовать крафтовое пиво или вино",
        "Посетите бар или винную лавку. Попробуйте крафтовое пиво или вино и узнайте о его производстве.",
        9,
    ),
    (
        "Попробовать завтрак в кафе",
        "Сходите на завтрак в новое кафе. Начните день с вкусной еды и хорошего настроения.",
        10,
    ),
    (
        "Попробовать блюдо по рекомендации",
        "Спросите у местных жителей рекомендацию и попробуйте это блюдо. Откройте скрытые жемчужины города.",
        11,
    ),
    (
        "Попробовать сезонное блюдо",
        "Попробуйте сезонное блюдо или напиток. Насладитесь вкусом текущего времени года.",
        12,
    ),
    (
        "Попробовать блюдо с необычными ингредиентами",
        "Попробуйте блюдо с необычными или экзотическими ингредиентами. Расширьте свои вкусовые границы.",
        13,
    ),
    (
        "Попробовать блюдо в ресторане с открытой кухней",
        "Посетите ресторан с открытой кухней. Наблюдайте за процессом приготовления и общайтесь с поварами.",
        14,
    ),
    (
        "Попробовать блюдо на вынос",
        "Закажите блюдо на вынос из нового места. Попробуйте его в парке или другом приятном месте.",
        15,
    ),
]

print("Adding food/island tasks...")
print()

with get_session() as session:
    # Проверяем, есть ли уже задания
    existing = session.query(Task).filter(Task.category == "food", Task.task_type == "island").count()

    if existing > 0:
        print(f"Found {existing} existing food/island tasks. Skipping.")
        sys.exit(0)

    # Добавляем задания
    added = 0
    for title, description, order_index in tasks_data:
        task = Task(
            category="food",
            title=title,
            description=description,
            task_type="island",
            order_index=order_index,
            is_active=True,
        )
        session.add(task)
        added += 1

    session.commit()
    print(f"Added {added} tasks for food/island")
