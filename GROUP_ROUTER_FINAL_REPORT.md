# üéâ –ì—Ä—É–ø–ø–æ–≤–æ–π —Ä–æ—É—Ç–µ—Ä - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä—É–ø–ø–æ–≤–æ–π —Ä–æ—É—Ç–µ—Ä (`group_router.py`)
- **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è** –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** –≤ `group` –∏ `supergroup` —á–∞—Ç–∞—Ö
- **–ù–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç** FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ —Å–µ—Ä–≤–∏—Å—ã –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- –°–≤—è–∑—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ **deep-link**

### 2. –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å** - –µ–¥–∏–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –ø–æ—Å—Ç –ø—Ä–∏ `/start`
- **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π** - deep-link –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (`/start=chat_{chat_id}`)
- **–°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π —á–∞—Ç–∞** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ `events_community`
- **"–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"** - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ –∏–∑ —á–∞—Ç–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏** - —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
#### –¢–∞–±–ª–∏—Ü–∞ `events_community` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)
```sql
- chat_id (–±—ã–ª–æ group_id)
- organizer_id (–±—ã–ª–æ creator_id) 
- starts_at (–±—ã–ª–æ date)
- organizer_username (–Ω–æ–≤–æ–µ)
- location_url (–Ω–æ–≤–æ–µ)
- status (–Ω–æ–≤–æ–µ)
- updated_at (–Ω–æ–≤–æ–µ)
```

#### –¢–∞–±–ª–∏—Ü–∞ `bot_messages` (–Ω–æ–≤–∞—è)
```sql
- chat_id, message_id - –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- tag - —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (panel, service, notification)
- deleted - —Ñ–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è
```

#### –¢–∞–±–ª–∏—Ü–∞ `chat_settings` (–Ω–æ–≤–∞—è)
```sql
- chat_id (PK)
- last_panel_message_id - ID –ø–∞–Ω–µ–ª—å-–ø–æ—Å—Ç–∞
- muted - —Ñ–ª–∞–≥ —Å–∫—Ä—ã—Ç–∏—è –±–æ—Ç–∞
```

### 4. –£—Ç–∏–ª–∏—Ç—ã (`utils/messaging_utils.py`)
- `ensure_panel()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –µ–¥–∏–Ω—ã–º –ø–∞–Ω–µ–ª—å-–ø–æ—Å—Ç–æ–º
- `send_tracked()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
- `delete_all_tracked()` - –º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- `is_chat_admin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –±–æ—Ç–æ–º
- –†–æ—É—Ç–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `bot_enhanced_v3.py`
- Username –±–æ—Ç–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–ª—è deep-links
- Deep-link –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø–∞–Ω–µ–ª—å-–ø–æ—Å—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
1. –ù–∞–∂–∏–º–∞–µ—Ç "‚ûï –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ"
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –õ–° –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –ø–æ deep-link
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ FSM `CommunityEventCreation`
4. –°–æ–±—ã—Ç–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `events_community` —Å `chat_id`

### –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
1. –ù–∞–∂–∏–º–∞–µ—Ç "üìã –°–æ–±—ã—Ç–∏—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞"
2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –ë–î –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞
3. –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è

### –°–∫—Ä—ã—Ç–∏–µ –±–æ—Ç–∞
1. –ù–∞–∂–∏–º–∞–µ—Ç "üëÅÔ∏è‚Äçüó®Ô∏è –°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"
2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ
3. –ë–æ—Ç —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª—è–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ 8 —Å–µ–∫

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ò–∑–æ–ª—è—Ü–∏—è
- ‚ùå **–ù–ï–¢** –∏–º–ø–æ—Ä—Ç–∞ FSM –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- ‚ùå **–ù–ï–¢** –∏–º–ø–æ—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞  
- ‚úÖ **–¢–û–õ–¨–ö–û** —Å—Ç—Ä–æ–∫–∞ username –¥–ª—è deep-links
- ‚úÖ **–¢–û–õ–¨–ö–û** —Ä–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö

### UX
- ‚úÖ **–ï–¥–∏–Ω—ã–π –ø–∞–Ω–µ–ª—å-–ø–æ—Å—Ç** - –Ω–µ —Å–ø–∞–º–∏—Ç —á–∞—Ç
- ‚úÖ **Deep-link —Å–æ–∑–¥–∞–Ω–∏–µ** - –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ –õ–°
- ‚úÖ **–ú–∞—Å—Å–æ–≤–æ–µ —Å–∫—Ä—ã—Ç–∏–µ** - –æ—á–∏—â–∞–µ—Ç —á–∞—Ç –æ—Ç —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã** - –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞** –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚úÖ **–¢—Ä–µ–∫–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π** –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–æ–≤** –¥–ª—è –ø–∞–Ω–µ–ª—å-–ø–æ—Å—Ç–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω `test_group_router.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ –ò–º–ø–æ—Ä—Ç–æ–≤ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–æ—É—Ç–µ—Ä–∞
- ‚úÖ ORM –º–æ–¥–µ–ª–µ–π
- ‚úÖ –§—É–Ω–∫—Ü–∏–π —É—Ç–∏–ª–∏—Ç
- ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä –∏ —Ç–µ–∫—Å—Ç–æ–≤

## üìã –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü—Ä–∏–º–µ–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ `001_fix_events_community.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ `002_add_bot_tracking.sql` - –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ì—Ä—É–ø–ø–æ–≤–æ–π —Ä–æ—É—Ç–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º—É
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

–¢–µ–ø–µ—Ä—å EventAroundBot –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (–ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π), —Ç–∞–∫ –∏ –≤ –≥—Ä—É–ø–ø–∞—Ö (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π)!
