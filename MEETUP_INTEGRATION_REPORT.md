# üéØ –û—Ç—á—ë—Ç: –ò–Ω–∂–µ—Å—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π + –ø–æ–∏—Å–∫ 5 –∫–º

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ `source`, `external_id`, `url` –≤ —Ç–∞–±–ª–∏—Ü—É `events`
- **–ò–Ω–¥–µ–∫—Å—ã**: –°–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç `migrations/add_meetup_columns.sql` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- **–§–∏–∫—Å—Ç—É—Ä—ã**: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

### 2. üîß –ì–µ–æ-—Ö–µ–ª–ø–µ—Ä—ã
- **–§–∞–π–ª**: `utils/geo_utils.py` (—É–∂–µ –±—ã–ª)
- **–§—É–Ω–∫—Ü–∏–∏**: 
  - `haversine_km()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
  - `get_bbox()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ bounding box (–¥–æ–±–∞–≤–ª–µ–Ω–∞)

### 3. üì¶ –ú–æ–¥—É–ª–∏ –∏–Ω–∂–µ—Å—Ç–∞

#### `event_apis.py`
- **RawEvent**: dataclass –¥–ª—è —Å—ã—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö API
- **fingerprint()**: —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –ø–æ `external_id` –∏–ª–∏ `fingerprint()`

#### `sources/meetup.py`
- **fetch()**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏–∑ Meetup API
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ `RawEvent`
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: graceful handling API failures

#### `ingest.py`
- **upsert_events()**: –≤—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ —Å rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 4. üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- **–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç**: `POST /events/sources/meetup/sync`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `lat`, `lng`, `radius_km` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5.0)
- **–û—Ç–≤–µ—Ç**: `{"inserted": N}` –∏–ª–∏ `{"error": "message", "inserted": 0}`

### 5. ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **ENV**: –î–æ–±–∞–≤–ª–µ–Ω `MEETUP_API_KEY` –≤ `.env.local.template`
- **Settings**: –û–±–Ω–æ–≤–ª–µ–Ω `config.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Meetup API –∫–ª—é—á–∞

### 6. üß™ –¢–µ—Å—Ç—ã
- **–§–∞–π–ª**: `tests/test_meetup_sync.py`
- **–¢–µ—Å—Ç—ã**:
  - `test_sync_meetup_smoke` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ API
  - `test_sync_meetup_then_nearby` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
  - `test_sync_meetup_boundary_5km` - –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ 5 –∫–º

## üöÄ Acceptance Criteria - –í–´–ü–û–õ–ù–ï–ù–û

### ‚úÖ `/events/sources/meetup/sync` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"inserted": N}` –±–µ–∑ –æ—à–∏–±–æ–∫
- –≠–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### ‚úÖ `/events/nearby?lat=‚Ä¶&lng=‚Ä¶&radius_km=5` –æ—Ç–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏—è —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
- –≠–Ω–¥–ø–æ–∏–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `distance_km` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ü–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ 5 –∫–º –¥–æ–±–∞–≤–ª–µ–Ω—ã

### ‚úÖ –õ—ë–≥–∫–∏–π CI –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∑–µ–ª—ë–Ω—ã–π (API/DB —Ç–µ—Å—Ç—ã skip)
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: `pytest -m "api or db"` –≤ –ª—ë–≥–∫–æ–º CI –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã
- 5 —Ç–µ—Å—Ç–æ–≤ deselected, 13 selected (–Ω–æ skipped)

### ‚úÖ ¬´–ü–æ–ª–Ω—ã–π¬ª —Ä–µ–∂–∏–º ‚Äî –∑–µ–ª—ë–Ω—ã–π
- –° `FULL_TESTS=1` —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ 18 —Ç–µ—Å—Ç–æ–≤ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –õ—ë–≥–∫–∏–π CI (—Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)
pytest -m "api or db"

# –ü–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º (—Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è)
FULL_TESTS=1 pytest -m "api or db"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç Meetup —Å–∏–Ω–∫–∞
FULL_TESTS=1 pytest tests/test_meetup_sync.py::test_sync_meetup_smoke -v

# Pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∞
pre-commit run --all-files
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–î–æ–±–∞–≤–∏—Ç—å –≤ `.env.local`**:
   ```
   MEETUP_API_KEY=your_meetup_api_key_here
   ```

2. **–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î**:
   ```sql
   \i migrations/add_meetup_columns.sql
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω–∫**:
   ```bash
   curl -X POST "http://localhost:8000/events/sources/meetup/sync?lat=-8.6501&lng=115.2166&radius_km=5"
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
   ```bash
   curl "http://localhost:8000/events/nearby?lat=-8.6501&lng=115.2166&radius_km=5"
   ```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∂–µ—Å—Ç–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! 

- ‚úÖ –ö–∞—Ä–∫–∞—Å –∏–Ω–∂–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–Ω
- ‚úÖ –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ (Meetup) –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `/events/nearby` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–µ–∂–∏–µ –∑–∞–ø–∏—Å–∏
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –õ—ë–≥–∫–∏–π –∏ –ø–æ–ª–Ω—ã–π CI —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

üíñ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üöÄ
