# üîß –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"

## ‚ùå –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ callback'–∏** - –≤ –ª–æ–≥–∞—Ö "–Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ"
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤** - –±–æ—Ç –Ω–µ –±—ã–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –æ—à–∏–±–∫–∏ "–≥–ª–æ—Ç–∞–ª–∏—Å—å"
4. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** - –≤–º–µ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏
5. **–ù–µ–ø–æ–ª–Ω–æ–µ —Ç—Ä–µ–∫–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π** - –Ω–µ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏—Å—å –≤ –ë–î

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback'–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** Callback'–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–†–µ—à–µ–Ω–∏–µ:** 
- –†–∞–∑–¥–µ–ª–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –¥–≤–∞ —ç—Ç–∞–ø–∞: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö callback'–æ–≤

```python
@group_router.callback_query(F.data == "group_hide_confirm")
async def group_hide_confirm(callback: CallbackQuery, bot: Bot):
    """–ü–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å"""

@group_router.callback_query(F.data.startswith("group_hide_execute_"))
async def group_hide_execute(callback: CallbackQuery, bot: Bot):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–∏—è –±–æ—Ç–∞"""
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø—ã—Ç–∞–ª—Å—è —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
bot_member = await bot.get_chat_member(chat_id, bot.id)
if bot_member.status != "administrator" or not getattr(bot_member, "can_delete_messages", False):
    logger.warning(f"üö´ –£ –±–æ—Ç–∞ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ {chat_id}")
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ "–≥–ª–æ—Ç–∞–ª–∏—Å—å", —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–º–µ—á–∞–ª–∏—Å—å –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

```python
try:
    await bot.delete_message(chat_id, bot_msg.message_id)
    bot_msg.deleted = True
    deleted += 1
except TelegramForbiddenError as e:
    # –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ - –ù–ï –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ!
    logger.error(f"üö´ –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è {bot_msg.message_id}: {e}")
except TelegramBadRequest as e:
    # –°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ - –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ
    logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ {bot_msg.message_id}: {e}")
    bot_msg.deleted = True
except Exception as e:
    # –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ - –ù–ï –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ!
    logger.error(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è {bot_msg.message_id}: {e}")
```

### 4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –≤–º–µ—Å—Ç–æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å —Å fallback –Ω–∞ send_tracked

```python
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
try:
    await bot.edit_message_text(
        chat_id=chat_id,
        message_id=callback.message.message_id,
        text=confirmation_text,
        reply_markup=keyboard,
        parse_mode="Markdown"
    )
except Exception as e:
    logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–Ω–µ–ª–∏: {e}")
    # Fallback - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ send_tracked
    from utils.messaging_utils import send_tracked
    with get_session() as session:
        await send_tracked(bot, session, chat_id=chat_id, text=confirmation_text, reply_markup=keyboard, tag="service")
```

### 5. –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–§–∞–π–ª:** `debug_hide_bot.py`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–µ–π –≤ bot_messages
- –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∫—Ä—ã—Ç–∏—è
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

## üîÑ –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å:

1. **–ö–Ω–æ–ø–∫–∞ "üëÅÔ∏è‚Äçüó®Ô∏è –°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"** ‚Üí –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø–∞–Ω–µ–ª—å)
2. **–î–∏–∞–ª–æ–≥** ‚Üí "‚úÖ –î–∞, —Å–ø—Ä—è—Ç–∞—Ç—å" –∏–ª–∏ "‚ùå –û—Ç–º–µ–Ω–∞"
3. **–ï—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞
   - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ bot_messages
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
   - –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ 8 —Å–µ–∫

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
üî• group_hide_confirm: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456 –∑–∞–ø—Ä–æ—Å–∏–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–∏—è –±–æ—Ç–∞ –≤ —á–∞—Ç–µ -100123456789
üî• –ü—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ —á–∞—Ç–µ -100123456789: status=administrator, can_delete_messages=True
üî• group_hide_execute: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456 –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å–∫—Ä—ã—Ç–∏–µ –±–æ—Ç–∞ –≤ —á–∞—Ç–µ -100123456789
‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ 123 (tag: panel)
‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ 124 (tag: service)
‚úÖ –£–¥–∞–ª–µ–Ω–æ 2 —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞ –≤ —á–∞—Ç–µ -100123456789
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–í—Å–µ callback'–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è** - –Ω–µ—Ç "–Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ" –≤ –ª–æ–≥–∞—Ö
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤** - –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤
3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –Ω–µ "–≥–ª–æ—Ç–∞–µ–º" –æ—à–∏–±–∫–∏
4. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏** - –Ω–µ —Å–æ–∑–¥–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
5. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–±–ª–µ–º

### üîç –ß—Ç–æ —É–¥–∞–ª—è–µ—Ç—Å—è:

- ‚úÖ –ü–∞–Ω–µ–ª—å-–ø–æ—Å—Ç –±–æ—Ç–∞ (tag: panel)
- ‚úÖ –î–∏–∞–ª–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (tag: service)
- ‚úÖ –°–ø–∏—Å–∫–∏ —Å–æ–±—ã—Ç–∏–π (tag: service)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (tag: notification)
- ‚ùå **–ù–ï —É–¥–∞–ª—è—é—Ç—Å—è** —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå **–ù–ï —É–¥–∞–ª—è—é—Ç—Å—è** –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

### üìä –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã**
2. **–£ –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∞–≤–æ "–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"**
3. **–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ –¥–æ–ª–∂–Ω—ã —Ç—Ä–µ–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ send_tracked()**

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≥—Ä—É–ø–ø—ã:

1. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –°–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
3. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–æ "–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

- `group_router.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
- `utils/messaging_utils.py` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- `debug_hide_bot.py` - —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–Ω–æ–≤—ã–π)

## üéâ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

–§—É–Ω–∫—Ü–∏—è "–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞" —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ –≤—Å–µ–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫!
