# üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–¢–µ–ø–µ—Ä—å –≤ –±–æ—Ç–µ –µ—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏—Ö **–≤ –≥—Ä—É–ø–ø–µ** –ø–æ –ø–æ—Ä—è–¥–∫—É:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞ –∏ –±–∞–∑–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
```
/__deltest
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ü—Ä–∞–≤–∞ –±–æ—Ç–∞ (—Å—Ç–∞—Ç—É—Å –∏ can_delete_messages)
- –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —É–¥–∞–ª—è—Ç—å —Å–≤–µ–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–µ –æ—à–∏–±–∫–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîç –ü—Ä–∞–≤–∞ –±–æ—Ç–∞:
status=administrator
can_delete_messages=True
‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, ID: 123
‚úÖ delete_message() —Å—Ä–∞–±–æ—Ç–∞–ª –Ω–∞ —Å–≤–µ–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏!
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–∫–∏–Ω–≥–∞ –≤ –ë–î
```
/__checkdb
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏ –≤ bot_messages –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞
- –ö–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–µ–∫–∞—é—Ç—Å—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É–¥–∞–ª–µ–Ω–Ω—ã—Ö/–∞–∫—Ç–∏–≤–Ω—ã—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìä –ù–∞–π–¥–µ–Ω–æ 5 –∑–∞–ø–∏—Å–µ–π –≤ bot_messages:

ID: 123, Tag: panel, Status: ‚úÖ –∞–∫—Ç–∏–≤–Ω–æ
ID: 124, Tag: service, Status: ‚úÖ –∞–∫—Ç–∏–≤–Ω–æ
...
–ê–∫—Ç–∏–≤–Ω—ã—Ö: 3, –£–¥–∞–ª–µ–Ω–Ω—ã—Ö: 2
```

### 3. –¢–µ—Å—Ç —Ç—Ä–µ–∫–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```
/__tracktest
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ send_tracked()
- –ó–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ send_tracked, ID: 125
‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∞–ª–æ—Å—å –≤ –ë–î:
chat_id: -1001234567890
tag: test
deleted: False
```

## üîç –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ï—Å–ª–∏ `/__deltest` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∞–≤:
```
‚õî –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ: Forbidden: bot is not a chat admin
```
**–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å –ø—Ä–∞–≤–æ–º "–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"

### –ï—Å–ª–∏ `/__checkdb` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫:
```
‚ùå –í bot_messages –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞!
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–∫–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ send_tracked()

### –ï—Å–ª–∏ `/__tracktest` –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ë–î:
```
‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –∑–∞–ø–∏—Å–∞–ª–æ—Å—å –≤ –ë–î!
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ –≤ send_tracked()
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏:
1. –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
2. –°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
3. –í–∫–ª—é—á–∏—Ç—å "–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"
4. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å `/__deltest`

### –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ ensure_panel() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å await
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ send_tracked()
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –ë–î:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ bot_messages —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (BIGINT –¥–ª—è chat_id/message_id)

## üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î –Ω–∞–ø—Ä—è–º—É—é:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∏ –¥–ª—è —á–∞—Ç–∞
SELECT chat_id, message_id, tag, deleted, created_at
FROM bot_messages
WHERE chat_id = -1001234567890  -- –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –≤–∞—à–µ–≥–æ —á–∞—Ç–∞
ORDER BY created_at DESC
LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
\d bot_messages;
```

### –õ–æ–≥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
–ò—â–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
- `üî• delete_all_tracked: –Ω–∞—á–∏–Ω–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ`
- `üî• –ù–∞–π–¥–µ–Ω–æ X —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è`
- `‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ X`
- `üö´ –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ`

## üéØ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ 3 –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é "–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —É–¥–∞–ª–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–µ—Ä:

1. –£–¥–∞–ª–∏—Ç–µ –∏–º–ø–æ—Ä—Ç –∏–∑ `bot_enhanced_v3.py`:
```python
# from debug_test_router import diag_router  # noqa: E402
```

2. –£–¥–∞–ª–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞:
```python
# dp.include_router(diag_router)  # –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```

3. –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª `debug_test_router.py`

–¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—è "–°–ø—Ä—è—Ç–∞—Ç—å –±–æ—Ç–∞" –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ
